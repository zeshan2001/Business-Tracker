{% extends 'base_investor.html' %} {% block content %}

<div class="business-profile">
      <div class="business-header">
          <div class="business-image">
            {% load static %}
              <img src="{% static business_id.image|cut:'main_app/static' %}" alt="{{ business_id.brand }}"/>
          </div>
          <div class="business-info">
              <h1 class="business-title">{{ business_id.brand }}</h1>
              <p class="business-description">{{ business_id.description }}</p>
              <div class="contact-info">
                  <h3 class="contact-title">Contact Information</h3>
                  <div class="contact-details">
                      <div class="contact-item">
                          <i class="fas fa-envelope"></i>
                          <span>Email: {{ owner.email }}</span>
                      </div>
                      <div class="contact-item">
                          <i class="fas fa-phone"></i>
                          <span>Phone Number: {{ owner.phone }}</span>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

<div class="pie-npv-charts-container">
  <!-- Pie Chart -->
  <div>
    <h2 class="ffscdr" align="center">Cost</h2>
    <canvas id="pieChart" width="400" height="200"></canvas>
  </div>
  <!-- NPV Chart -->
  <div>
    <h2 class="ffscdr" align="center">NPV</h2>
    {% if is_loss %}
        <p class="ffscdr">not predictable, out of data</p>
      {% else %}
      <canvas id="npvChart" width="600" height="400"></canvas>  
      {% endif %}
  </div>
</div>

<script>

  // Pie Chart
  const pieCtx = document.getElementById('pieChart').getContext('2d');
  new Chart(pieCtx, {
    type: 'pie',
    data: {
      labels: {{ pie_labels|safe }},
      datasets: [{
        label: 'Cost Distribution',
        data: {{ pie_data|safe }},
        backgroundColor: [
          'rgba(255, 99, 132, 0.7)',
          'rgba(54, 162, 235, 0.7)',
          'rgba(255, 206, 86, 0.7)',
          'rgba(75, 192, 192, 0.7)'
        ],
        borderColor: [
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(75, 192, 192, 1)'
        ],
        borderWidth: 1
      }]
    }
  });

  const ctx = document.getElementById('npvChart').getContext('2d');
  const discountRates = {{ discount_rates|safe }};   // e.g. [0, 5, 10, 15, 20, 25, 30, 35, 40]
  const npvValues = {{ npv_values|safe }};           // e.g. [40000, 30000, 20000, 10000, 0, -8000, -12000, -16000, -18000]
  const irrRate = ({{ irr|safe }} * 100) / 5;                        // e.g. 20.42
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: discountRates,
      datasets: [{
          label: 'NPV Curve',
          data: npvValues.reverse(),
          borderColor: 'blue',
          borderWidth: 2,
          fill: false,
          tension: 0.2
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        annotation: {
          annotations: {
            zeroLine: {
                type: 'line',
                yMin: 0,
                yMax: 0,
                borderColor: 'black',
                borderWidth: 1
            },
            irrLine: {
              type: 'line',
              xMin: irrRate,
              xMax: irrRate,
              borderColor: 'red',
              borderDash: [6, 6],
              borderWidth: 2,
              label: {
                enabled: true,
                content: 'IRR â‰ˆ ' + irrRate.toFixed(2) + '%',
                position: 'start',
                backgroundColor: 'rgba(255,255,255,0.7)',
                color: 'red'
              }
            }
          }
        }
      },
      scales: {
        x: { title: { display: true, text: 'Discount Rate (%)' } },
        y: { title: { display: true, text: 'NPV ($)' } }
      }
    }
  });
</script>

{% endblock %}
